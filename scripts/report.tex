\documentclass[11pt,article,oneside]{memoir}
\usepackage{tikz}
\usepackage{contour}
\usepackage{tabularx}
\usepackage{array}
\usepackage{colortbl}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{datetime}
\usepackage[table]{xcolor}
\usepackage[explicit]{titlesec}

\usepackage[code=Code39,X=.5mm,ratio=2.25,H=1cm]{makebarcode}
\pretitle{\flushleft\includegraphics[width=5cm]{logo}\\\flushleft\LARGE\textsf}
\posttitle{}
\preauthor{\flushleft\large\textsf}
\postauthor{\\\vspace{5mm}\hrule\vspace{5mm}}
\predate{\flushleft\textsf Report generated on~}
\postdate{}

\counterwithout{section}{chapter}
\definecolor{theme}{HTML}{D8E6B8}
\setlength{\textwidth}{15cm}
\setlength{\oddsidemargin}{0cm}
\setsecindent{-1cm}



%%\titleformat{\section}
%%{\normalfont\Large\bfseries}
%%{}
%%{2em}
%%{\colorbox{theme}{\parbox[m]{\dimexpr\textwidth-2.5cm\relax}{#1\textcolor{red}}}%
%%\hspace{1mm}\colorbox{theme}{\parbox{0.1cm}{{\textcolor{theme}{\rule{0.1cm}{0.45cm}}}}}%
%%\hspace{1mm}\colorbox{theme}{\parbox{0.4cm}{{\textcolor{theme}{\rule{0.1cm}{0.45cm}}}}}}

\titleformat{\section}
{\normalfont\Large\bfseries}
{}
{2em}
{\colorbox{theme}{\begin{minipage}[c][1cm]{\dimexpr\textwidth-2.5cm\relax}\hspace{5mm}#1\end{minipage}}%
\hspace{1mm}%
\colorbox{theme}{\begin{minipage}[c][1cm]{4mm}~\end{minipage}}%
\hspace{1mm}%
\colorbox{theme}{\begin{minipage}[c][1cm]{2mm}~\end{minipage}}%
\hspace{1mm}%
\colorbox{theme}{\begin{minipage}[c][1cm]{1mm}~\end{minipage}}%
}



\begin{document}
\author{Automatically generated by the  PyFR testing framework}
\title{\textsc Commit Test Report}
\date{\today~at \currenttime}
\maketitle

\section{Commit information}
\setlength\fboxsep{5pt}
\def\trule{\arrayrulecolor{gray}\toprule}
\def\mrule{\arrayrulecolor{theme}\midrule}
\def\arraystretch{1.5}
\begin{center}
\fcolorbox{gray}{theme!20!white}{
	\begin{tabular}{>{\bfseries\textsf}rp{8cm}}
	\trule
	Id	      & ${tag}\\\mrule
	User	      & ${info['Author-name']}\\\mrule
	E Mail	      & \texttt{${info['Author-email']}}\\\mrule
	Submit date and time  &	${info['Submit-time']}\\\trule
	Commit number & \texttt{${info['Commit-hash']}}\\\mrule
	Commit code  & { \setlength\fboxrule{0pt}\fbox{\barcode{${info['Commit-hash-abbr'].upper()}}}}\\\mrule
	Commit date  & ${info['Commit-Date']}\\\mrule
      Commit comment  & ${info['Subject']}\\\trule
     \end{tabular}
}
\end{center}


% for t in testInfo:
\section{Test `\texttt{${t.replace('_','\_')}}'}
\subsection{CPU Timing and  Memory }
\def\arraystretch{1.3}

\def\trule{\arrayrulecolor{theme!80!black}\toprule[0.7mm]}
\def\mrule{\arrayrulecolor{theme!90!black}\cmidrule[0.5mm]{1-9}}
\def\nrule{\arrayrulecolor{theme!90!black}\cmidrule[0.4mm]{2-9}}
\def\orule{\arrayrulecolor{theme!90!black}\cmidrule[0.3mm]{3-9}}
\begin{tabular}{lccrrrrrrr}
	\bfseries\textsf{Precision} &\bfseries\textsf{Mode} & \bfseries\textsf{Backend} & \bfseries\textsf{Elapsed} & \bfseries\textsf{CPU} & \bfseries\textsf{Kernel} & \bfseries\textsf{CPU\%} & \bfseries\textsf{Mem(kB)} & \bfseries\textsf{Exit} ${"\\\\"}\trule
% for i,(p,s,b) in enumerate(itertools.product(combinations[0][0],combinations[1][0],combinations[2][0])):
% if i%combinations[0][1]==0:
	\multirow{${combinations[0][1]}}{*}{\textsf{${p}}}&\
% else:
     &\
% endif
% if i%combinations[1][1]==0:
	\multirow{${combinations[1][1]}}{*}{\textsf{${s}}}&\
% else:
     &\
% endif
% if i%combinations[2][1]==0:
	\multirow{${combinations[2][1]}}{*}{\textsf{${b}}}&\
% else:
     &\
% endif
\textsf{${runInfo[t][b+"/"+s+"/"+p]['cfg']['elapsed']}}& \
\textsf{${runInfo[t][b+"/"+s+"/"+p]['cfg']['user-time']}}& \
\textsf{${runInfo[t][b+"/"+s+"/"+p]['cfg']['kernel-time']}}& \
\textsf{${runInfo[t][b+"/"+s+"/"+p]['cfg']['CPU-percent']}}& \
	\textsf{${runInfo[t][b+"/"+s+"/"+p]['cfg']['MaxMemory']}}& \
% if runInfo[t][b+"/"+s+"/"+p]['cfg']['flag'] :
\cellcolor{green!25}\
% else:
\cellcolor{red!25}\
% endif
\textsf{${runInfo[t][b+"/"+s+"/"+p]['cfg']['flag']}} \
${"\\\\"}\
% if (i+1)%combinations[0][1]==0:
\mrule
% elif (i+1)%combinations[1][1]==0:
\nrule
% elif (i+1)%combinations[2][1]==0:
\orule
% endif
% endfor
\trule
\end{tabular}

% for S in testInfo[t].sections():
\subsection{${S}}
\def\arraystretch{1.0}
<% files=testInfo[t].items(S) %>\
\def\trule{\arrayrulecolor{theme!80!black}\toprule[0.7mm]}
\def\mrule{\arrayrulecolor{theme!90!black}\cmidrule[0.5mm]{1-${2+len(files)*2}}}
\def\nrule{\arrayrulecolor{theme!90!black}\cmidrule[0.4mm]{2-${2+len(files)*2}}}
\def\orule{\arrayrulecolor{theme!90!black}\cmidrule[0.3mm]{3-${2+len(files)*2}}}
\begin{tabular}{cc${"c"*len(files)*2}}
	\trule
\multirow{2}{*}{\bfseries\textsf{Mode}} & \multirow{2}{*}{\bfseries\textsf{Backend}} & \
% for p in combinations[0][0]:
\multicolumn{${len(files)}}{c}{\bfseries\textbf{${p}}} \
${"" if p == combinations[0][0][-1] else "&"} \
% endfor
${"\\\\"}\orule
&&
% for p in combinations[0][0]:
<% files=testInfo[t].items(S) %>\
${"&".join(["\\bfseries\\textsf{%s}"%title for title,f in files])} \
${"" if p == combinations[0][0][-1] else "&"} \
% endfor
${"\\\\"}\trule

% for i,(s,b) in enumerate(itertools.product(combinations[1][0],combinations[2][0])):
% if i%combinations[1][1]==0:
\multirow{${combinations[1][1]}}{*}{\raisebox{-3cm}{\rotatebox{90}{\Large\bfseries\textsf{${s}}}}}&\
% else:
&\
% endif
% if i%combinations[2][1]==0:
\rotatebox{90}{\bfseries\textsf{${b}}}&\
% else:
&\
% endif
% for p in combinations[0][0]:
<% files=testInfo[t].items(S) %>\
${"&".join(["\\raisebox{-.3\\height}{\\includegraphics[height=2.5cm]{%s}}"%runInfo[t][b+"/"+s+"/"+p]['files'][S][title] for title,f in files])}\
${"" if p == combinations[0][0][-1] else "&"} \
% endfor
${"\\\\"}\
% if (i+1)%combinations[1][1]==0:
\mrule
% elif (i+1)%combinations[2][1]==0:
\nrule
% endif
% endfor
\trule
\end{tabular}






% endfor
% endfor


\section{Event Log}
\noindent
<% N = -1 %>\
% for i,l in enumerate(log): 
<% NN = math.floor(i/50) %>\
	% if NN>N:
	% if NN>0:
\end{tabular}
}
\end{minipage}
	% endif
<% N=NN %>\
\begin{minipage}[t]{0.5\linewidth}
\scalebox{0.5}{
\def\arraystretch{1.5}
\begin{tabular}{r>{\bfseries\textsf}lrr}
	% endif
<% color = "" %>\
% if l[0].find("CUDA")>=0 :
<% color = '\\cellcolor{green!25}' %>\
% endif
% if l[0].find("OpenMP")>=0 :
<% color = '\\cellcolor{blue!15}' %>\
% endif
% if l[0].find("OpenCL")>=0 :
<% color = '\\cellcolor{yellow!35}' %>\
% endif
	% if l[1][1] is None:
${i+1}&${color}\texttt{${l[0].replace('_','\_')}} & \cellcolor{red!25}\texttt{${l[1][0]}} & \cellcolor{red!25}\texttt{-} ${"\\\\"}
	% else:
${i+1}&${color}\texttt{${l[0].replace('_','\_')}} & \texttt{${l[1][0]}} & \texttt{${str(l[1][1]-l[1][0])+"s"}} ${"\\\\"}
	% endif
% endfor
\end{tabular}
}
\end{minipage}
\end{document}
